gapi.analytics.ready(function(){function e(e){var t;a[e].instance.on("error",function(t){$("#"+a[e].chart.container).html('<div class="loading"><span><i class="fa fa-exclamation-triangle"></i>Error loading</span></div>')}),a[e].instance.on("success",function(n){var i=function(){$("#"+a[e].chart.container).html('<div class="loading"><span><i class="fa fa-spin fa-refresh"></i>Refreshing view</span></div>'),clearTimeout(t),t=setTimeout(function(){s(e)},500)},s=function(e){a[e].chart.instance=new gapi.analytics.googleCharts.DataChart(a[e]),a[e].chart.instance.execute()};$(window).resize(i),Concrete.event.subscribe("PanelClose",i),$("a").click(function(){$("html").hasClass("ccm-panel-open")&&i()})})}var a={};if(window.ga_access_token){gapi.analytics.auth.authorize({serverAuth:{access_token:window.ga_access_token.access_token}}),a.traffic={query:{ids:"ga:"+window.ga_profile_id,"start-date":"30daysAgo","end-date":"yesterday",metrics:"ga:sessions,ga:users",dimensions:"ga:date"},chart:{container:"siteTrafficChart",type:"LINE",options:{width:"100%"}}},a.pages={query:{ids:"ga:"+window.ga_profile_id,"start-date":"30daysAgo","end-date":"yesterday",metrics:"ga:uniquePageviews",dimensions:"ga:pageTitle, ga:pagePath",sort:"-ga:uniquePageviews","max-results":10},chart:{container:"topPagesChart",type:"TABLE",options:{width:"100%"}}},a.referrals={query:{ids:"ga:"+window.ga_profile_id,"start-date":"30daysAgo","end-date":"yesterday",metrics:"ga:users",dimensions:"ga:source, ga:referralPath",sort:"-ga:users","max-results":20},chart:{container:"trafficSourcesChart",type:"TABLE",options:{width:"100%"}}},a.activeUsers={component:"ActiveUsers",opts:{ids:"ga:"+window.ga_profile_id,container:"activeUsers",pollingInterval:5,title:window.component_translations.activeUsers}},a.bounceRate={component:"HeroMetric",opts:{ids:"ga:"+window.ga_profile_id,"start-date":"30daysAgo","end-date":"yesterday",metrics:"ga:bounceRate",title:window.component_translations.bounceRate,container:"bounceRate",mutator:function(e){return e+"%"}}},a.sessionDuration={component:"HeroMetric",opts:{ids:"ga:"+window.ga_profile_id,"start-date":"30daysAgo","end-date":"yesterday",metrics:"ga:avgSessionDuration",title:window.component_translations.visitDuration,container:"avgVisitDuration",mutator:function(e){return parseFloat(e/60).toFixed(2)}}},a.loadTime={component:"HeroMetric",opts:{ids:"ga:"+window.ga_profile_id,"start-date":"30daysAgo","end-date":"yesterday",metrics:"ga:avgPageLoadTime",title:window.component_translations.pageLoadTime,container:"avgPageLoad",mutator:function(e){return e+"s"}}};for(var t in a){var n=window.ga_access_token.expires<=Math.round((new Date).getTime()/1e3);a[t].chart?(a[t].instance=new gapi.analytics.googleCharts.DataChart(a[t]),e(t)):a[t].component&&(a[t].instance=new gapi.analytics.ext[a[t].component](a[t].opts)),n?a[t].instance.emit("expired.token",window.ga_access_token.expires):a[t].instance.execute()}}});